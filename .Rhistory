remove.packages("PAM")
install()
library(PAM)
devtools::install()
library(PAM)
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
###Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "TRESS"
)### option to use exomePeak2/TRESS
??bplapply
fun <- function(v) {
message("working") ## 10 tasks
sqrt(v)
}
BiocParallel::bplapply(1:10, fun)
setwd("C:/Users/dd284/OneDrive/harry/PAM")
devtools::install()
library(PAM)
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
###Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "TRESS"
)### option to use exomePeak2/TRESS
remove.packages("TRESS")
BiocManager::install("TRESS")
library(devtools)
library(devtools)
install.packages("htmltools")
library(devtools)
library(datasetTRES)
#####Required
library(GenomicRanges)
library(TRESS)
library(AnnotationDbi)
library(Rsamtools)
library(purrr)
library(Matrix)
library(matrixStats)
library(RColorBrewer)
library(reshape2)
library(BiocParallel)
library(openxlsx)
library(dplyr)
library(DESeq2)
library(aod)
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
#setwd("/Users/daoyuduan/Library/CloudStorage/OneDrive-Personal/harry/m6a_power")
library(miceadds)
source.all(path = "./")
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
#setwd("/Users/daoyuduan/Library/CloudStorage/OneDrive-Personal/harry/m6a_power")
library(miceadds)
source.all(path = "./")
source.all(path = "./")
source.all(path = "./")
##Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "TRESS"
)### option to use exomePeak2/TRESS
library(GenomicFeatures)
install.packages("GenomicFeatures")
install.packages("GenomicFeatures")
library(GenomicFeatures)
library(devtools)
library(datasetTRES)
#####Required
library(GenomicRanges)
library(TRESS)
library(AnnotationDbi)
library(Rsamtools)
library(purrr)
library(Matrix)
library(matrixStats)
library(RColorBrewer)
library(reshape2)
library(BiocParallel)
library(openxlsx)
library(dplyr)
library(DESeq2)
library(aod)
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
#setwd("/Users/daoyuduan/Library/CloudStorage/OneDrive-Personal/harry/m6a_power")
library(miceadds)
source.all(path = "./")
###Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "TRESS"
)
###Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "exomePeak2"
)### option to use exomePeak2/TRESS
View(res_all2)
save(res_all2, "res_all2.rdata")
save(res_all2, file = "res_all2.rdata")
library(devtools)
library(datasetTRES)
#####Required
library(GenomicRanges)
library(TRESS)
library(AnnotationDbi)
library(Rsamtools)
library(purrr)
library(Matrix)
library(matrixStats)
library(RColorBrewer)
library(reshape2)
library(BiocParallel)
library(openxlsx)
library(dplyr)
library(DESeq2)
library(aod)
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
#setwd("/Users/daoyuduan/Library/CloudStorage/OneDrive-Personal/harry/m6a_power")
library(miceadds)
source.all(path = "./")
###Main function
power.test = PowerEval(
Input.file = c("Ctrl1.chr1.input.bam", "Ctrl2.chr1.input.bam","Case1.chr1.input.bam", "Case2.chr1.input.bam"),
IP.file = c("Ctrl1.chr1.ip.bam", "Ctrl2.chr1.ip.bam","Case1.chr1.ip.bam", "Case2.chr1.ip.bam"),
BamDir = "./data/GSE46705_split_chr",
annoDir = "./data/annotation/hg18_chr1.sqlite",
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.08,
nsim = 10,
N.reps = c(2,3),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1)
,Test_method = "exomePeak2"
)### option to use exomePeak2/TRESS
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("AnnotationHubData")
AnnotationHubData::makeAnnotationHubMetadata
ï¼ŸAnnotationHubData::makeAnnotationHubMetadata
?AnnotationHubData::makeAnnotationHubMetadata
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("RNAseqData.HNRNPC.bam.chr14")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("SCLCBam")
library(SCLCBam)
getPathBamFolder()
cat(SCLCBam:::.wrap(getPathBamFolder()))
paths <- readRDS("C:/Users/dd284/AppData/Local/R/win-library/4.2/SCLCBam/help/paths.rds")
features <- readRDS("C:/Users/dd284/AppData/Local/R/win-library/4.2/SCLCBam/Meta/features.rds")
vignette <- readRDS("C:/Users/dd284/AppData/Local/R/win-library/4.2/SCLCBam/Meta/vignette.rds")
View(vignette)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("TBX20BamSubset")
getwd()
TBX20BamSubset::getBamFileList()
getwd()
load("C:/Users/dd284/OneDrive/harry/m6a_power/example/GSE46705_res.rdata")
PlotRes(power.test, depth_factor = 1, value_option = "FDR")
library(PAM)
PlotRes(power.test, depth_factor = 1, value_option = "FDR")
PlotAll(power.test, depth_factor = 1)
###plot an individual strata result
PlotStrata(power.test, value_option = "FDR")##add na
PlotALL_Strata(power.test)
load("C:/Users/dd284/OneDrive/harry/m6a_power/example/GSE55575_res.rdata")
PlotRes(power.test, depth_factor = 1, value_option = "FDR")
PlotAll(power.test, depth_factor = 1)
PlotALL_Strata(power.test)
###plot an individual strata result
PlotStrata(power.test, value_option = "FDR")##add na
Power.list = power.test
View(power.test)
Power.list <- Power.list[["1x"]][5:8]
par(mfrow = c(2, 2))
for (value_option in c("FDR", "FDC", "Power", "Precision")) {
power_sub <- Power.list[[value_option]]
# names(power_sub) = names(Power.list)
power_sub <- melt(power_sub,
id.vars = c("N.rep"),
variable.name = "Strata",
value.name = paste0(value_option)
)
# FDR.toP = Power.list[["FDR"]]
# par(mfrow = c(2,2))
# df_plot <- power_sub[[paste0(SD_multiplier, "x")]]
df_plot <- power_sub
names(df_plot)[1] <- "Number of Replicates"
xvals <- split(df_plot[, 2], df_plot[, 1])
yvals <- split(df_plot[, 3], df_plot[, 1])
plot(seq_along(unique(as.factor(unlist(xvals)))),
ylim = c(0, max(unlist(yvals), na.rm = TRUE)), type = "n", xaxt = "n",
xlab = "Average Input Strata by Percentile", ylab = value_option
)
mapply(lines, xvals, yvals,
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))],
pch = seq_len(nrow(unique(df_plot[1]))), type = "o"
)
axis(1,
at = seq_along(unique(as.factor(unlist(xvals)))),
labels = unique(as.factor(unlist(xvals)))
)
title(main = paste0(value_option, " by Strata \n", "Sequencing Depth: 1x"))
# mtext(side = 3, line = 0.25, at = 1, adj = -2, "Sequencing Depth: 1x")
legend("bottomleft",
legend = paste0("n = ", unique(df_plot[, 1])),
title = "",
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))], pch = seq_len(nrow(unique(df_plot[1]))), cex = 0.8, bty = "n", bg = "transparent"
)
}
library(reshape2)
for (value_option in c("FDR", "FDC", "Power", "Precision")) {
power_sub <- Power.list[[value_option]]
# names(power_sub) = names(Power.list)
power_sub <- melt(power_sub,
id.vars = c("N.rep"),
variable.name = "Strata",
value.name = paste0(value_option)
)
# FDR.toP = Power.list[["FDR"]]
# par(mfrow = c(2,2))
# df_plot <- power_sub[[paste0(SD_multiplier, "x")]]
df_plot <- power_sub
names(df_plot)[1] <- "Number of Replicates"
xvals <- split(df_plot[, 2], df_plot[, 1])
yvals <- split(df_plot[, 3], df_plot[, 1])
plot(seq_along(unique(as.factor(unlist(xvals)))),
ylim = c(0, max(unlist(yvals), na.rm = TRUE)), type = "n", xaxt = "n",
xlab = "Average Input Strata by Percentile", ylab = value_option
)
mapply(lines, xvals, yvals,
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))],
pch = seq_len(nrow(unique(df_plot[1]))), type = "o"
)
axis(1,
at = seq_along(unique(as.factor(unlist(xvals)))),
labels = unique(as.factor(unlist(xvals)))
)
title(main = paste0(value_option, " by Strata \n", "Sequencing Depth: 1x"))
# mtext(side = 3, line = 0.25, at = 1, adj = -2, "Sequencing Depth: 1x")
legend("bottomleft",
legend = paste0("n = ", unique(df_plot[, 1])),
title = "",
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))], pch = seq_len(nrow(unique(df_plot[1]))), cex = 0.8, bty = "n", bg = "transparent"
)
}
library(RColorBrewer)
for (value_option in c("FDR", "FDC", "Power", "Precision")) {
power_sub <- Power.list[[value_option]]
# names(power_sub) = names(Power.list)
power_sub <- melt(power_sub,
id.vars = c("N.rep"),
variable.name = "Strata",
value.name = paste0(value_option)
)
# FDR.toP = Power.list[["FDR"]]
# par(mfrow = c(2,2))
# df_plot <- power_sub[[paste0(SD_multiplier, "x")]]
df_plot <- power_sub
names(df_plot)[1] <- "Number of Replicates"
xvals <- split(df_plot[, 2], df_plot[, 1])
yvals <- split(df_plot[, 3], df_plot[, 1])
plot(seq_along(unique(as.factor(unlist(xvals)))),
ylim = c(0, max(unlist(yvals), na.rm = TRUE)), type = "n", xaxt = "n",
xlab = "Average Input Strata by Percentile", ylab = value_option
)
mapply(lines, xvals, yvals,
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))],
pch = seq_len(nrow(unique(df_plot[1]))), type = "o"
)
axis(1,
at = seq_along(unique(as.factor(unlist(xvals)))),
labels = unique(as.factor(unlist(xvals)))
)
title(main = paste0(value_option, " by Strata \n", "Sequencing Depth: 1x"))
# mtext(side = 3, line = 0.25, at = 1, adj = -2, "Sequencing Depth: 1x")
legend("bottomleft",
legend = paste0("n = ", unique(df_plot[, 1])),
title = "",
col = brewer.pal(n = nrow(unique(df_plot[1])), name = "Set1")[seq_len(nrow(unique(df_plot[1])))], pch = seq_len(nrow(unique(df_plot[1]))), cex = 0.8, bty = "n", bg = "transparent"
)
}
value_option = "FDR"
power_sub <- Power.list[[value_option]]
# names(power_sub) = names(Power.list)
power_sub <- melt(power_sub,
id.vars = c("N.rep"),
variable.name = "Strata",
value.name = paste0(value_option)
)
View(power_sub)
power_sub <- Power.list[[value_option]]
View(power_sub)
View(power.test)
power.test[[1]]
View(power.test)
?dcast
factor(c("(0, 9.34]", "(17.24, 28.74]", "(28.74, Inf]", "(9.34, 17.24]"))
factor(c("(0, 9.34]", "(9.34, 17.24]"), "(17.24, 28.74]", "(28.74, Inf]")
factor(c("(0, 9.34]", "(9.34, 17.24]"), "(17.24, 28.74]", "(28.74, Inf]"))
factor(c("(0, 9.34]", "(9.34, 17.24]", "(17.24, 28.74]", "(28.74, Inf]"))
View(power.test)
load("C:/Users/dd284/OneDrive/harry/m6a_power/example/115105_res.rdata")
PlotRes(power.test, depth_factor = 1, value_option = "FDR")
dev.off()
PlotRes(power.test, depth_factor = 1, value_option = "FDR")
PlotAll(power.test, depth_factor = 1)
PlotALL_Strata(power.test)
###plot an individual strata result
PlotStrata(power.test, value_option = "FDR")##add na
View(power.test)
View(power.test[[1]])
View(power.test[[1]][[5]])
View(power.test[[1]][[6]])
View(power.test[[1]][[7]])
View(power.test[[1]][[8]])
devtools::document()
?QuickPower
devtools::document()
?QuickPower
devtools::document()
?QuickPower
devtools::document()
?QuickPower
devtools::document()
?QuickPower
devtools::document()
?QuickPower
devtools::document()
devtools::document()
?QuickPower
styler::style_pkg(transformers = styler::tidyverse_style(indent_by = 4))
?DESeq2::results
?TRESS::TRESS_DMRtest
load("C:/Users/dd284/OneDrive/harry/m6a_power/res_all2_test.rdata")
View(res_all2)
sort(1:10)
warnings()
sort(1:10)
sort(c(10,2,4))
nreps = c(2,2)
data.frame(
Reps = c(
rep(paste0("Rep", seq_len(nreps[1])), each = 2),
rep(paste0("Rep", seq_len(nreps[2])), each = 2)
),
IP = rep(c("Input", "IP"), sum(nreps)),
Trt = rep(c("Ctrl", "Trt"), 2 * nreps)
)
DESeq2::results
?p.adjust
?replicate
replicate(1, matrix(1:100,10,10))
replicate(1, matrix(1:100,10,10), simplify = FALSE)
replicate(2, matrix(1:100,10,10), simplify = FALSE)
counts = do.call(
"rbind",
replicate(1,
matrix(1:100,10,10),
simplify = FALSE
)
)
View(counts)
counts = do.call(
"rbind",
replicate(2,
matrix(1:100,10,10),
simplify = FALSE
)
)
?makeTxDbFromUCSC
supportedUCSCtables
library(GenomicFeatures)
supportedUCSCtables()
?saveDb
head(seqlevels(txdb))
?makeTxDbFromGFF()
####
setwd("C:/Users/dd284/OneDrive/harry/m6a_power")
############
txdb = makeTxDbFromGFF("./data/annotation/hg18.gtf",
format = "gtf")
saveDb(txdb , file = "hg18.sqlite")
txdb = makeTxDbFromGFF("./data/annotation/hg18_chr1.gtf",
format = "gtf")
saveDb(txdb , file = "hg18_chr1.sqlite")
txdb = makeTxDbFromGFF("./data/annotation/mm10.gtf",
format = "gtf")
saveDb(txdb , file = "mm10.sqlite")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("BiocStyle")
getwd()
txdb = makeTxDbFromGFF("./data/annotation/hg18_chr15.gtf",
format = "gtf")
saveDb(txdb , file = "hg18_chr15.sqlite")
library(PAMData)
library(PAM)
BAM_path <- GetBAMPath()
BAM_path
###Call PowerEval
power.test <- PowerEval(
Input.file = c("Ctrl1.chr15.input.bam", "Ctrl2.chr15.input.bam","Case1.chr15.input.bam", "Case2.chr15.input.bam"),
IP.file = c("Ctrl1.chr15.ip.bam", "Ctrl2.chr15.ip.bam","Case1.chr15.ip.bam", "Case2.chr15.ip.bam"),
BamDir = BAM_path,
annoDir = paste0(BAM_path, "/hg18_chr15.sqlite"),
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.03,
nsim = 10,
N.reps = c(2,3,5,7),
depth_factor = c(1,2),
= c(0.01, 0.05, 0.1)
###Call PowerEval
power.test <- PowerEval(
Input.file = c("Ctrl1.chr15.input.bam", "Ctrl2.chr15.input.bam","Case1.chr15.input.bam", "Case2.chr15.input.bam"),
IP.file = c("Ctrl1.chr15.ip.bam", "Ctrl2.chr15.ip.bam","Case1.chr15.ip.bam", "Case2.chr15.ip.bam"),
BamDir = BAM_path,
annoDir = paste0(BAM_path, "/hg18_chr15.sqlite"),
variable = rep(c("Ctrl", "Trt"), each = 2),
bam_factor = 0.03,
nsim = 10,
N.reps = c(2,3,5,7),
depth_factor = c(1,2),
thres = c(0.01, 0.05, 0.1),
Test_method = "exomePeak2"
)
rep(" ",4)
data.frame(FDR =  rep(" ",4),
N.rep = c(2,3,5,7),
0.01 = c(0.21, 0.11, 0.05, 0.02),
data.frame(FDR =  rep(" ",4),
N_rep = c(2,3,5,7),
0.01 = c(0.21, 0.11, 0.05, 0.02),
data.frame(FDR =  rep(" ",4),
N_rep = c(2,3,5,7),
d0.01 = c(0.21, 0.11, 0.05, 0.02),
d0.05 = c(0.38, 0.25, 0.13, 0.07),
d0.1 = c(0.46, 0.35, 0.20, 0.13))
data.frame(FDR =  rep(" ",4),
N.rep = c(2,3,5,7),
0.01 = c(0.21, 0.11, 0.05, 0.02),
data.frame(FDR =  rep(" ",4),
N_rep = c(2,3,5,7),
s0.01 = c(0.21, 0.11, 0.05, 0.02),
s0.05 = c(0.38, 0.25, 0.13, 0.07),
s0.1 = c(0.46, 0.35, 0.20, 0.13))
names(tb1) <- c("FDR", "N.rep", "0.01", "0.05", "0.1")
tb1 <- data.frame(FDR =  rep(" ",4),
N_rep = c(2,3,5,7),
s0.01 = c(0.21, 0.11, 0.05, 0.02),
s0.05 = c(0.38, 0.25, 0.13, 0.07),
s0.1 = c(0.46, 0.35, 0.20, 0.13))
names(tb1) <- c("FDR", "N.rep", "0.01", "0.05", "0.1")
kableExtra::kable(tb1)
?kable
?kable_styling
styler::style_pkg(transformers = styler::tidyverse_style(indent_by = 4))
